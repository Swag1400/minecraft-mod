package me.comu.client.module.impl.toggle.exploits;

import org.lwjgl.input.Mouse;

import me.comu.api.event.Listener;
import me.comu.api.minecraft.helper.PlayerHelper;
import me.comu.client.events.MotionUpdateEvent;
import me.comu.client.module.ModuleType;
import me.comu.client.module.ToggleableModule;
import me.comu.client.utils.Helper;
import net.minecraft.network.play.client.C03PacketPlayer;
import net.minecraft.util.BlockPos;

public final class Teleport extends ToggleableModule
{                                    
    private boolean canTP;
    private int delay;
    private BlockPos endPos;

    public Teleport()
    {
        super("Teleport", new String[] {"teleport", "tp"}, ModuleType.EXPLOITS);
         listeners.add(new Listener<MotionUpdateEvent>("firion_motion_update_listener")
        {
            @Override
            public void call(MotionUpdateEvent event) {
                if (canTP && Mouse.isButtonDown(1) && ! minecraft.thePlayer.isSneaking() &&  delay == 0 &&  minecraft.inGameHasFocus) {
                    event.setCanceled(true);
                     endPos =  minecraft.objectMouseOver.getPos();
                    final double[] startPos = {  minecraft.thePlayer.posX,  minecraft.thePlayer.posY,  minecraft.thePlayer.posZ };
                    PlayerHelper.blinkToPos(startPos,  endPos, 0.0, new double[] { 0.3, 0.2 });
                    Helper.sendPacket(new C03PacketPlayer.C04PacketPlayerPosition( endPos.getX() + 0.5,  endPos.getY() - 1.0,  endPos.getZ() + 0.5, false));
                     minecraft.thePlayer.setPosition( endPos.getX() + 0.5,  endPos.getY() + 1, endPos.getZ() + 0.5);
                     delay = 5;
                    event.setCanceled(false);
                }
                if ( delay > 0) {
                    -- delay;
                }
            }
        });
}
}
