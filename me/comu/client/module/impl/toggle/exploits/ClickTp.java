package me.comu.client.module.impl.toggle.exploits;

import me.comu.api.event.Listener;
import me.comu.client.events.TickEvent;
import me.comu.client.module.ModuleType;
import me.comu.client.module.ToggleableModule;
import net.minecraft.network.play.client.C03PacketPlayer;
import net.minecraft.util.BlockPos;

import java.util.ArrayList;
import java.util.Iterator;

/**
 * Created by comu on 5/24/2018
 */
public class ClickTp extends ToggleableModule {

    public boolean didTp;
    public double[] positions;


    public ClickTp() {
        super("ClickTp", new String[] {"ClickTp", "tp"}, 0xFFFF2E2E, ModuleType.EXPLOITS);
        this.listeners.add(new Listener<TickEvent>("civbreak_packet_listener")
        {

            @Override
            public void call(TickEvent event) {
                didTp = false;
                if (!minecraft.gameSettings.keyBindUseItem.pressed) {
                    didTp = false;
                }

                if (minecraft.gameSettings.keyBindUseItem.pressed && minecraft.objectMouseOver.getPos() != null && !didTp) {
                    final BlockPos blockpos = minecraft.objectMouseOver.getPos();
                    final ArrayList<Double> positionz = new ArrayList<Double>();
                    positions = new double[]{0.08, 0.26, 0.49, 0.74, 1.01, 1.28, 1.55, 1.83, 2.11, 2.39, 2.67, 2.95, 3.23, 3.51, 3.79, 4.07, 4.35, 4.63, 4.92, 5.2, 5.48, 5.76, 6.04, 6.32, 6.6, 6.88, 7.16, 7.44, 7.72, 8.0, 8.28, 8.56, 8.84, 9.12, 9.41, 9.69, 9.97, 10.25};
                    for (int length = (positions = positions).length, i = 0; i < length; ++i) {
                        final double pos = positions[i];
                        if (minecraft.thePlayer.getDistance(blockpos.getX(), minecraft.thePlayer.posY, blockpos.getZ()) > pos) {
                            positionz.add(pos);
                        }
                    }
                    final Iterator<Double> iterator = positionz.iterator();
                    while (iterator.hasNext()) {
                        final double pos = iterator.next();
                        final double xOffset = pos * Math.cos(Math.toRadians(minecraft.thePlayer.rotationYaw + 90.0f));
                        final double zOffset = pos * Math.sin(Math.toRadians(minecraft.thePlayer.rotationYaw + 90.0f));
                        final boolean doTp = minecraft.theWorld.getCollidingBoundingBoxes(minecraft.thePlayer, minecraft.thePlayer.boundingBox.offset(xOffset, 1.0E-5, zOffset)).isEmpty();
                        if (doTp) {
                            minecraft.thePlayer.sendQueue.addToSendQueue(new C03PacketPlayer.C04PacketPlayerPosition(minecraft.thePlayer.posX + xOffset, minecraft.thePlayer.posY, minecraft.thePlayer.posZ + zOffset, true));
                            if (pos != positionz.get(positionz.size() - 1)) {
                                continue;
                            }
                            minecraft.thePlayer.setPositionAndUpdate(minecraft.thePlayer.posX + xOffset, minecraft.thePlayer.posY, minecraft.thePlayer.posZ + zOffset);
                        }
                    }
                }

            }
        });
    }
}
