package me.comu.client.module.impl.toggle.exploits;

import me.comu.api.event.Listener;
import me.comu.api.stopwatch.Stopwatch;
import me.comu.client.events.PacketEvent;
import me.comu.client.module.ModuleType;
import me.comu.client.module.ToggleableModule;
import me.comu.client.properties.NumberProperty;
import net.minecraft.network.play.client.C02PacketUseEntity;

public final class InfiniteDurability extends ToggleableModule
{
    private final NumberProperty<Long> delay = new NumberProperty<>(100L, 0L, 5000L, 50L, "Delay", "d");

    private boolean switchItem = false;

    private final Stopwatch stopwatch = new Stopwatch();

    public InfiniteDurability()
    {
        super("InfiniteDurability", new String[] {"infinitedurability", "id", "durability","infinitedura","infdura","infdurability"}, 0xFFC47C2F, ModuleType.EXPLOITS);
        this.offerProperties(delay);
        this.listeners.add(new Listener<PacketEvent>("infinite_durability_packet_listener")
        {
            @Override
            public void call(PacketEvent event)
            {
                if (event.getPacket() instanceof C02PacketUseEntity)
                {
                    C02PacketUseEntity c02PacketUseEntity = (C02PacketUseEntity) event.getPacket();

                    if (c02PacketUseEntity.getAction() == C02PacketUseEntity.Action.ATTACK)
                    {
                        switchItem = !switchItem;

                        if (stopwatch.hasCompleted(delay.getValue()))
                        {
                            minecraft.thePlayer.inventory.currentItem = switchItem ? 1 : 0;
                            stopwatch.reset();
                        }
                    }
                }
            }
        });
    }
}
