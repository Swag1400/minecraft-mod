package me.comu.client.module.impl.toggle.exploits;

import me.comu.api.event.Listener;
import me.comu.api.stopwatch.Stopwatch;
import me.comu.client.events.MotionUpdateEvent;
import me.comu.client.module.ModuleType;
import me.comu.client.module.ToggleableModule;
import me.comu.client.properties.EnumProperty;
import me.comu.client.properties.Property;
import net.minecraft.item.*;
import net.minecraft.network.play.client.C03PacketPlayer;
import net.minecraft.network.play.client.C07PacketPlayerDigging;
import net.minecraft.util.BlockPos;
import net.minecraft.util.EnumFacing;

public final class FastUse extends ToggleableModule
{
    private final Property<Boolean> bows = new Property<>(true, "Bows", "bow", "b"), potions = new Property<>(true, "Potions", "potion", "pot", "pots", "p"), milk = new Property<>(true, "Milk", "m"), food = new Property<>(true, "Food", "f");
    private final EnumProperty<Mode> mode = new EnumProperty<>(Mode.DELAY, "Mode", "m");
    private final Stopwatch stopwatch = new Stopwatch();

    public FastUse()
    {
        super("FastUse", new String[] {"fastuse", "fu", "iu", "instantuse","fast"}, 0xFFFCCC5B, ModuleType.EXPLOITS);
        this.offerProperties(bows, potions, milk, food, mode);
        this.listeners.add(new Listener<MotionUpdateEvent>("fast_use_motion_update_listener")
        {
            @Override
            public void call(MotionUpdateEvent event)
            {
                if (isValidItem(minecraft.thePlayer.inventory.getCurrentItem()) && minecraft.thePlayer.onGround)
                {
                    if ((mode.getValue() == Mode.DELAY && minecraft.thePlayer.getItemInUseDuration() >= 15))
                    {
                        for (int index = 0; index < 6; index++)
                        {
                            minecraft.func_175102_a().addToSendQueue(new C03PacketPlayer(minecraft.thePlayer.onGround));
                            minecraft.func_175102_a().addToSendQueue(new C03PacketPlayer(minecraft.thePlayer.onGround));
                            minecraft.func_175102_a().addToSendQueue(new C03PacketPlayer(minecraft.thePlayer.onGround));
                            minecraft.func_175102_a().addToSendQueue(new C03PacketPlayer(minecraft.thePlayer.onGround));
                            minecraft.func_175102_a().addToSendQueue(new C03PacketPlayer(minecraft.thePlayer.onGround));
                        }

                        minecraft.func_175102_a().addToSendQueue(new C07PacketPlayerDigging(C07PacketPlayerDigging.Action.RELEASE_USE_ITEM, BlockPos.ORIGIN, EnumFacing.DOWN));
                        minecraft.thePlayer.stopUsingItem();
                    }
                }
            }
        });
    }

    private boolean isValidItem(ItemStack itemStack) {
        if (itemStack != null) {
            if ((itemStack.getItem() instanceof ItemPotion && potions.getValue()) || (itemStack.getItem() instanceof ItemBucketMilk && milk.getValue()) || (itemStack.getItem() instanceof ItemBow && bows.getValue()) || (itemStack.getItem() instanceof ItemFood && food.getValue())) {
                return minecraft.thePlayer.isUsingItem();
            }
        }
        return false;
    }



    public enum Mode
    {
        DELAY,
    }
}
