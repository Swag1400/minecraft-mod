package me.comu.client.module.impl.toggle.exploits;

import me.comu.api.event.Listener;
import me.comu.api.stopwatch.Stopwatch;
import me.comu.client.core.Gun;
import me.comu.client.events.PacketEvent;
import me.comu.client.logging.Logger;
import me.comu.client.module.ModuleType;
import me.comu.client.module.ToggleableModule;
import me.comu.client.utils.Helper;
import net.minecraft.network.play.client.C14PacketTabComplete;
import net.minecraft.network.play.server.S3APacketTabComplete;

public final class Plugins extends ToggleableModule
{
    private final Stopwatch stopwatch = new Stopwatch();

    public Plugins()
    {
        super("Plugins", new String[] {"plugins", "plug-ins", "plug","serverplugins"}, ModuleType.EXPLOITS);
        this.listeners.add(new Listener<PacketEvent>("infinite_durability_packet_listener")
        {
            @Override
            public void call(PacketEvent event)
            {
                if ((event.getPacket() instanceof S3APacketTabComplete))
                {
                    S3APacketTabComplete packet = (S3APacketTabComplete)event.getPacket();
                    String[] commands = packet.func_149630_c();
                    String message = "";
                    int size = 0;
                    String[] array;
                    int length = (array = commands).length;
                    for (int i = 0; i < length; i++) {
                    	   String command = array[i];
                           String pluginName = command.split(":")[0].substring(1);
                           if ((!message.contains(pluginName)) && (command.contains(":")) && (!pluginName.equalsIgnoreCase("minecraft")) && (!pluginName.equalsIgnoreCase("bukkit")))
                           {
                        	   size++;
                               if (message.isEmpty()) {
                                 message = message + pluginName;
                               } else {
                                 message = String.valueOf(message) + "ยง8, ยง7" + pluginName;
                               }
                           }
                    }
                    if (!message.isEmpty()) {
                        Logger.getLogger().printToChat("Plugins (" + size + "): ยง7" + message + "ยง8.");
                } else {
                	Logger.getLogger().printToChat("Plugins: None Found!");
                }
                    event.setCanceled(true);
                    Gun.getInstance().getEventManager().unregister(this);
                }
                if (stopwatch.hasCompleted(15000)) {
                	Gun.getInstance().getEventManager().unregister(this);
                	Logger.getLogger().printToChat("Could not listen for a S3APacketTabComplete! (15s)! ");
                }
            }
        });
    }
    public void onEnable(String[] p0) throws Error {
    	stopwatch.reset();
    	Gun.getInstance().getEventManager().register(null);
    	Helper.sendPacket(new C14PacketTabComplete("/"));
    	Logger.getLogger().printToChat("Listening for a S3aPacketTabComplete! (15s)");
    }
}
